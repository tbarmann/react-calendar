<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
    <script src="build/react.js"></script>
    <script src="build/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.1.min.js"></script>

    <script type="text/javascript" src="./js/helpers.js"></script>

  </head>
  <body>
    <div id="main"></div>
   <script type="text/babel">

      var App = React.createClass({
        getInitialState() {
          return {events:[]};
        },
        componentDidMount () {
          this.loadEvents();
        },

        loadEvents(){
            $.getJSON('./data/events.js',function(data){
               this.setState({events:data});
            }.bind(this))
        },

        render(){
          return (
            <div>
              {this.state.events.map(function(event,i){
                return <Cell key={i} event={event}/>
              })}
            </div>
          )
        }

      });

      var Cell = React.createClass({
        propTypes : {
          event: React.PropTypes.shape({
            d: React.PropTypes.number.isRequired,
            t: React.PropTypes.string.isRequired,
            title: React.PropTypes.string.isRequired
          }).isRequired
        },

        render(){
          var event = this.props.event;
          return (
            <table className="cell-table">
              <tbody>
                <tr><td><CellDate day={event.d}/></td></tr>
                <tr><td><CellEvent time={event.t} title={event.title} /></td></tr>
              </tbody>
            </table>
            )
        }

      });

     var CellDate = React.createClass({
        render(){
          return (
            <span className="cell-date">{this.props.day}</span>
            )
        }

      });

    var CellEvent = React.createClass({
        render(){
          return (
            <div className="cell-event-item">
              <span className="cell-event-time">{this.props.time}</span>&nbsp;
              <span className="cell-event-title">{this.props.title}</span>
            </div>
            )
        }

      });

    var CalendarMonth = React.createClass({
      render() {
        var m = parseInt(this.props.month);
        var y = parseInt(this.props.year);
        var weeks = helpers.getCalendarMonthArray(m,y);
        var monthName = helpers.getNameOfMonth(m);
        return (
          <div>
            <span className="month-name">{monthName}</span>&nbsp;
            <span className="year">{y}</span>
            <table>
              <tbody>
                <tr><td>S</td><td>M</td><td>T</td><td>W</td><td>T</td><td>F</td><td>S</td></tr>
                {weeks.map(function(week, i) {
                  return (
                    <tr key={i}>
                      {week.map(function(day, j) {
                        return (
                          <td key={j}>
                            {day === null ? "" : day}
                          </td>
                        );
                      })}
                    </tr>
                  );
                })}  
              </tbody>
            </table>
          </div>
          );

      }

    })


  //    var app = React.createElement(App);
      ReactDOM.render(<CalendarMonth month="2" year="2016"/>,document.getElementById('main'))
   </script>


  </body>
</html>